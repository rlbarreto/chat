<!DOCTYPE html>
<html>
  <head>
    <% include partials/header.ejs %>
  </head>
  <body ng-app="chat">
    <div class="container" ng-controller="MainController as mainCtrl">
      <div ng-hide="mainCtrl.data.authenticated">
        <div class="col-md-12">
          <form ng-controller="LoginController as loginCtrl" ng-submit="loginCtrl.login(loginCtrl.username.trim(), loginCtrl.password)">
            <input type="text"
            class="form-control center-text"
            ng-model="loginCtrl.username"
            placeholder="Enter your username"
            autocomplete="off"
            required
            autofocus
            >
            <input type="password"
            class="form-control center-text"
            ng-model="loginCtrl.password"
            placeholder="Enter your password"
            autocomplete="off"
            required
            autofocus
            >
            <input type="submit" value="send">
          </form>
        </div>
      </div>
      <div ng-show="mainCtrl.data.authenticated">
        <div class="col-md-4" ng-controller="ChatController as chatCtrl">
          <ul>
            <li ng-repeat="friend in chatCtrl.data.friends"
              ng-click="chatCtrl.newChatRoom(friend, chatCtrl.data.selectedFriend)"
              class="friend"
              ng-class="{selected: friend.selected, newMessage: friend.newMessage && !friend.selected}">
              {{::friend.name}}
            </li>
          </ul>
          <div ng-show="chatCtrl.data.selectedFriend && chatCtrl.data.selectedFriend.room">
            <div
              ng-class="{newMessage: chatCtrl.data.selectedFriend.newMessage}"
              ng-click="chatCtrl.data.selectedFriend.newMessage = false">
              Chatting with <label>{{::chatCtrl.data.selectedFriend.name}}</label>
            </div>
            <div style="height:40px">
              <div style="width:80%; float:left">
                <input type="text"
                class="form-control"
                ng-model="chatCtrl.data.selectedFriend.room.chatInput"
                placeholder="Enter your message"
                autocomplete="off"
                required
                autofocus
                >
              </div>
              <div style="width:20%; float:left">
                <input type="button" value="Send" ng-click="chatCtrl.sendMessage(chatCtrl.data.selectedFriend)">
              </div>
            </div>
            <div>
              <div ng-repeat="message in chatCtrl.data.selectedFriend.room.messages">
                <label>{{::message.from}}:</label> {{::message.text}}</li>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <% include partials/scripts.ejs %>
  </body>
</html>
